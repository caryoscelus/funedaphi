<?xml version="1.0" encoding="UTF-8"?>
<mod>
    <action name="generate-airship">
        <object name="newmap"/>
        
        <code>
def generateAirship(newmap):
    width = 32
    height = 48
    
    newmap.resize(width, height)
    
    cx = int(width/2)
    cy = int(height/2)
    
    x0, x1 = -1, -1
    
    def getEclispseX(y, width, height):
        dx = width/height * math.sqrt((height/4+width/4)**2-(y-height/2)**2*width/height)
        x0 = int(cx + dx)
        x1 = int(cx - dx)
        return x0, x1
    
    # make ship outline
    for y in range(height):
        ox = [x0, x1]
        x0, x1 = getEclispseX(y, width, height)
        try:
            newmap.putOn(x0, y, 'ground', Entity({'class':'wall'}))
            newmap.putOn(x1, y, 'ground', Entity({'class':'wall'}))
            if ox[0] != -1 and ox[0] != x0:
                tr = range(ox[0], x0) if ox[0] &lt; x0 else range(x0+1, ox[0]+1)
                for r in tr:
                    newmap.putOn(r, y, 'ground', Entity({'class':'wall'}))
            if ox[1] != -1 and ox[1] != x1:
                tr = range(ox[1], x1) if ox[1] &lt; x1 else range(x1+1, ox[1]+1)
                for r in tr:
                    newmap.putOn(r, y, 'ground', Entity({'class':'wall'}))
        except TiledMapSizeError:
            warning('can\'t place!')
    
    y = 0
    x0, x1 = getEclispseX(y, width, height)
    
    
    
    action('map-fill-area', {'self':newmap, 'position':'ground', 'fill':'floor', 'limit':'wall', 'x':cx, 'y':cy})
    newmap.setAttr('centre', (cx, cy))
    newmap.setExist(True)
    
    
    x, y = cx-1, cy-1
    newmap.putOn(x, y, 'system', action('make-spawn', {'spawn':'rat-spawn', 'position':'monster', 'probability':1/1}))
    
    info('new airship')
    
    return True

_return = generateAirship(newmap)
        </code>
    </action>
</mod>
