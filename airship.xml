<?xml version="1.0" encoding="UTF-8"?>
<mod>
    <action name="generate-airship">
        <object name="newmap"/>
        
        <code>
def generateAirship(newmap):
    width = 32
    height = 48
    
    newmap.resize(width, height)
    
    cx = int(width/2)
    cy = int(height/2)
    
    x0, x1 = -1, -1
    
    # make ship outline
    for y in range(height):
        dx = width/height * math.sqrt((height/4+width/4)**2-(y-height/2)**2*width/height)
        ox = [x0, x1]
        x0 = int(cx + dx)
        x1 = int(cx - dx)
        try:
            newmap.putOn(x0, y, 'ground', Entity({'class':'wall'}))
            newmap.putOn(x1, y, 'ground', Entity({'class':'wall'}))
            if ox[0] != -1 and ox[0] != x0:
                newmap.putOn(ox[0], y, 'ground', Entity({'class':'wall'}))
            if ox[1] != -1 and ox[1] != x1:
                newmap.putOn(ox[1], y, 'ground', Entity({'class':'wall'}))
        except TiledMapSizeError:
            warning('can\'t place!')
    
    #action('map-fill-area', {'position':'ground', 'fill':'floor', 'limit':'wall', 'x':cx, 'y':cy})
    newmap.setAttr('centre', (cx, cy))
    newmap.setExist(True)
    
    info('new airship')
    
    return True

_return = generateAirship(newmap)
        </code>
    </action>
</mod>
